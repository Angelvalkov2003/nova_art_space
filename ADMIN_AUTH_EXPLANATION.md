# Как работи админ акаунтът

## Общо описание

Админ акаунтът използва **Supabase Authentication** с базирана на бисквитки (cookies) сесия. Това означава, че:

1. **Всяко устройство/браузър трябва да се логне отделно** - това е нормално поведение за сигурност
2. Сесията се съхранява в бисквитки на браузъра
3. Сесията се обновява автоматично при всяка заявка

## Как работи автентикацията

### 1. Логин процес
- Потребителят въвежда имейл и парола на `/admin/login`
- Supabase проверява данните
- При успех се създава сесия и се записват бисквитки в браузъра
- Бисквитките съдържат токен за достъп

### 2. Защита на админ страниците
- Всички страници в `/admin/*` (освен `/admin/login`) са защитени
- `middleware.ts` проверява дали потребителят е логнат при всяка заявка
- Ако не е логнат, се пренасочва към `/admin/login`

### 3. Управление на сесията
- `middleware.ts` автоматично обновява сесията при всяка заявка
- Това гарантира, че сесията не изтича докато сте активни
- Бисквитките се конфигурират с `sameSite: 'lax'` за по-добра съвместимост

## Защо трябва да се логвате от всяко устройство отделно?

### Това е нормално поведение!

**Бисквитките са специфични за браузър и устройство:**
- Всеки браузър (Chrome, Firefox, Safari) има свои собствени бисквитки
- Всеки уред (компютър, телефон, таблет) има свои собствени бисквитки
- Това е **безопасностна функция**, която предотвратява неоторизиран достъп

### Примери:
- ✅ Логнете се на компютъра → работи на този компютър
- ✅ Логнете се на телефона → работи на този телефон
- ❌ Логването на компютъра НЕ ви дава достъп на телефона автоматично

## Как да използвате админ панела от различни устройства

### Стъпка 1: Отворете админ страницата
На всяко устройство отворете: `https://вашият-домейн.com/admin/login`

### Стъпка 2: Влезте с вашите данни
Въведете същите имейл и парола на всяко устройство

### Стъпка 3: Сесията се запазва
След логин, сесията ще се запази на това устройство докато:
- Не излезете (logout)
- Бисквитката не изтече (обикновено след 7 дни неактивност)
- Не изчистите бисквитките на браузъра

## Сигурност

### Защо е важно да се логвате отделно?
1. **Защита срещу кражба на сесия** - ако някой получи достъп до един уред, не може да достъпи другите
2. **Контрол на достъпа** - можете да видите и контролирате активните сесии
3. **Съответствие с GDPR** - всеки уред има отделна сесия

### Препоръки за сигурност:
- ✅ Използвайте силна парола
- ✅ Не споделяйте паролата
- ✅ Излизайте (logout) когато не използвате админ панела на споделени устройства
- ✅ Регулярно проверявайте активните сесии

## Технически детайли

### Файлове свързани с автентикация:
- `middleware.ts` - управлява сесиите и защитава админ страниците
- `app/lib/auth.ts` - функции за проверка на автентикация
- `app/admin/login/page.tsx` - страница за логин
- `app/admin/page.tsx` - главна админ страница (защитена)

### Бисквитки:
- Име: `sb-*-auth-token` (Supabase автоматично генерира името)
- Валидност: 7 дни (по подразбиране в Supabase)
- SameSite: `lax` (за по-добра съвместимост)
- Secure: `true` в production (само HTTPS)

## Често срещани проблеми

### Проблем: "Не мога да се логна от друг уред"
**Решение:** Това е нормално! Трябва да се логнете отделно на всеки уред.

### Проблем: "Сесията изтича твърде бързо"
**Решение:** Проверете дали не изчиствате бисквитките. Middleware автоматично обновява сесията.

### Проблем: "Логването работи на един браузър, но не на друг"
**Решение:** Всеки браузър има свои бисквитки. Логнете се отделно във всеки браузър.

## Заключение

Админ акаунтът работи правилно! Необходимостта да се логвате отделно на всяко устройство е **нормална и желателна** функция за сигурност. Това гарантира, че достъпът до админ панела е контролиран и сигурен.
